# 採点について

チューニング結果を各チームの VM に反映し、[評価スクリプト](../app/03_Scripts.md#評価スクリプト)をそれぞれの VM 内で実行することで採点ができます。

評価スクリプトでは、以下のプロセスで評価を行います。

- Step1. データベースを初期状態に戻す (顧客データをセット)
- Step2. 簡易 DB マイグレーションの実行
- Step3. API 動作テスト (e2e テスト)の実施
- Step4. 負荷試験の実施
- Step5. スコアの計算
- Step6. スコアの表示 & 運営への送信

Step3 では[API 仕様書](../../api-specs/openapi_defn.yaml)をベースに、主要な要件を満たしているかをチェックします。問題があった場合はそこで採点が停止します。

Step6 で画面に表示されたスコアが、その時点のチームの持ち点になります。

※スコア上位グループについては、成果物に対して追加で審議される場合があります。

## Step2 の補足

### 簡易 DB マイグレーション機能

評価スクリプトを実行する度にデータベースの状態は戻ってしまいますが、あらかじめ登録された SQL を実行させ、テーブル等への変更を採点前に反映させることができます。

`webapp/`ディレクトリの`mysql/migration/`に置かれた{数字}\_\*.sql ファイルは、採点前に実行されます。
0_name.sql, 1_name.sql...という名称のファイルを置いておくことで、番号が若い順に実行されていきます。

## Step4 の補足

負荷試験はシナリオテストの形で行われます。つまり、アプリケーションの想定される利用シナリオについて複数のユーザが同じ操作を行い、制限時間内に処理できたシナリオの数に応じてスコアが変動します。

### 想定するシナリオ
負荷試験では、下記の2つのシナリオを実施します。
（より詳しい定義は [業務背景によるレギュレーション](./02_Regulation.md#業務背景によるレギュレーション)も参考にしてください）：

1. **ユーザージャーニーに沿って下記の操作を実施**
    1. **ログイン**
    2. **商品一覧画面を表示**
    3. **商品一覧画面で別のページを表示**
    4. **商品一覧画面で任意のカラムを選択し、ソートを実施**
    5. **商品の検索**
    6. **注文を作成して送信**
    7. **注文履歴画面を表示**
    8. **注文履歴画面で任意のカラムを選択し、ソートを実施**
    9. **注文を前方一致または部分一致で検索**
2. **ロボットによって行われる操作に関して、下記の操作を実施**
    1. **配送計画を取得**
    2. **配送した商品のステータスを変更**



このシナリオが複数のユーザによって同時に実行される状況を想定します。

- シナリオの途中でのチェック（上記のシナリオの各ステップが完了しているか）に失敗した場合、そのシナリオは中断され、新たにシナリオを開始します。

### 負荷試験の詳細

Step4 では、負荷試験ツール「k6」を用いて、上記の2つのシナリオを並行して3分間実施します。（ローカルでは30秒間）

## Step5 の補足
Step5 では、上記の2つのシナリオそれぞれの成功数の和がそのままスコアとして算出されます。

※ 採点についてより詳しい情報は `/benchmarker` 配下を参考にしてください。

---

[トップ](../../README.md)
